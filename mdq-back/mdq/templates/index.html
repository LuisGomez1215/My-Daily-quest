{% extends "layouts/master.html" %}
{% block content %}
{% load static %}

<body style="background-image: url('{% static "backgrounds/background.png" %}')">
    <div class="container">
        <div class="d-flex justify-content-center align-items-center petscreen position-relative">
            <img class="h100 w100 img-fluid" src="{% static "backgrounds/boxpet.png" %}">
            <div class="pet-overlay position-absolute top-50 bottom-50 start-50 translate-middle">
                {% if not petcheck %}
                <a href="{% url 'petselect' %}">
                    <img class="h100 w100 img-fluid" src="{% static "icons/PETBOX.png" %}">
                </a>
                {% else %}
                <div class="pet-wrapper position-relative d-inline-block">
                    <img class="img-fluid spot-offset" src="{% static 'icons/PETSPOT.png' %}">
                    <img class="pet img-fluid position-absolute top-50 start-50 translate-middle"
                    src="{{ pet.species.pet_avatar.url }}"
                    alt="{{ pet.name }}">
                </div>
                {% endif %}
            </div>
        </div>
        {% if petcheck %}
        <div class="pet-stats text-center mt-3 border rounded">
            <p class="mb-1">Lv {{ pet.level }}</p>
            <div class="progress">
                <div id="exp-bar" class="progress-bar bg-primary"
                role="progressbar"
                aria-valuenow="{{ current_exp }}"
                aria-valuemin="0"
                aria-valuemax="{{ next_level_exp }}">
                </div>
            </div>
            <p class="small mt-1">
                {{ current_exp|floatformat:0 }} / {{ next_level_exp|floatformat:0 }} EXP
            </p>
            <p class="mt-2 mb-1">HP</p>
            <p class="mb-1">{{ pet.hp }}/{{ pet.hp }}</p>
            <p class="mt-2 mb-1">Stamina</p>
            <p class="mb-1">{{  pet.stamina }}/{{ pet.stamina }}</p>
            <p class="mt-2 mb-0">Mood: <strong>{{ pet.mood_status }}</strong></p>
            <p class="mt-2 mb-1">Bond</p>
            {% for i in "12345" %}
            {% if forloop.counter <= pet.bond_meter %}
            <span style="color: red;">●</span>
            {% else %}
            <span style="color: #ddd;">●</span>
            {% endif %}
            {% endfor %}
            {% endif %}
        </div>
    </div>
</body>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const bar = document.getElementById("exp-bar");
        const targetPercent = {{ percentage|floatformat:0 }};
        let currentPercent = 0;

        const interval = setInterval(() => {
            if (currentPercent >= targetPercent) {
                clearInterval(interval);
            } else {
                currentPercent++;
                bar.style.width = currentPercent + "%";
                bar.setAttribute("aria-valuenow", currentPercent);
            }
        }, 10);
    });
</script>
{% endblock %}